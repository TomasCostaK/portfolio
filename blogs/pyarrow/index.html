<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Pandas 2.0 - How to make your DataFrame manipulations super fast! | TomasCostaK</title>
<meta name=keywords content="ML,Data Science"><meta name=description content="How Panda's new update will boost your Data transformations as a Data Practitioner"><meta name=author content="TomasCostaK"><link rel=canonical href=https://tomascostak.github.io/blogs/pyarrow/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://tomascostak.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomascostak.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomascostak.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tomascostak.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tomascostak.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomascostak.github.io/blogs/pyarrow/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Pandas 2.0 - How to make your DataFrame manipulations super fast!"><meta property="og:description" content="How Panda's new update will boost your Data transformations as a Data Practitioner"><meta property="og:type" content="article"><meta property="og:url" content="https://tomascostak.github.io/blogs/pyarrow/"><meta property="og:image" content="https://tomascostak.github.io/blogs/pyarrow/covers/pandas.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2024-07-15T11:30:00+00:00"><meta property="article:modified_time" content="2024-07-15T11:30:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tomascostak.github.io/blogs/pyarrow/covers/pandas.png"><meta name=twitter:title content="Pandas 2.0 - How to make your DataFrame manipulations super fast!"><meta name=twitter:description content="How Panda's new update will boost your Data transformations as a Data Practitioner"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://tomascostak.github.io/blogs/"},{"@type":"ListItem","position":2,"name":"Pandas 2.0 - How to make your DataFrame manipulations super fast!","item":"https://tomascostak.github.io/blogs/pyarrow/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Pandas 2.0 - How to make your DataFrame manipulations super fast!","name":"Pandas 2.0 - How to make your DataFrame manipulations super fast!","description":"How Panda's new update will boost your Data transformations as a Data Practitioner","keywords":["ML","Data Science"],"articleBody":"Panda’s new update just dropped and with this new update, many new improvements were introduced.\nJetBrain’s Developer Survey shows that 55% of Python users, use Panda’s library. Therefore, we know that this massive library adoption comes with a potential to give a lot of performance boost to everyone using it. This is exactly the main point of this new 2.0.0 update.\nPandas 2.0.0 The main change to Panda’s 2.0.0 that we will be covered in this article is the new backend support for Apache Arrow.\nFor many years, the main extension to represent arrays and perform operations on them in a fast way has been NumPy. And this is what pandas was initially built on.\nAnd although NumPy has been instrumental in making pandas the widely-used library it is today, it wasn’t designed to be a backend for dataframe libraries, and it has several notable shortcomings. For instance, it provides limited support for strings and doesn’t include a native mechanism for handling missing values.\nDealing with missing (null) values in pandas has been challenging, partially since it doesn’t allow null values for certain data types, such as integer dtypes. Consequently, introducing a null value in an integer column caused the entire column to be converted to a float dtype. This sudden conversion from integer to float was far from ideal. This is just one of the points that Arrow solves.\nWhat is Apache Arrow? According to Apache Arrow’s website:\n“Apache Arrow defines a language-independent columnar memory format for flat and hierarchical data, organized for efficient analytic operations on modern hardware like CPUs and GPUs. The Arrow memory format also supports zero-copy reads for lightning-fast data access without serialization overhead.”\nThis means that the format is language-independent and there is no need to make copy and conversion operations between different data types. This makes it a great format to perform in-memory analytics, something that most Data Science practitioners perform daily.\nColumnar data stores are designed to store data in a way that groups related columns together in memory. This results in faster data operations such as calculating the average value of a column. Additionally, Arrow data types also include helpful features such as treatment for missing values and interoperability, which will are discussed below.\nWhy is this important? There’s several important new additions with the PyArrow change, below are some of the most notable ones.\nMissing values As we have mentioned previously, missing values are a complex topic.\nInitially, pandas handled missing values by converting numbers to floating point and using NaN. However, this approach had limitations, particularly when converting integers to floating point.\nWith the introduction of extension arrays, pandas added its own data types for missing values using two arrays, one for the data and another for boolean values indicating presence or absence of data.\nThis approach is similar to the one used by Apache Arrow’s in-memory data representation. By using Arrow, pandas can manage missing values across data types without creating its own version for each type.\nInteroperability Like a CSV file, Arrow is a universal data format that is compatible with various programs such as pandas, R, and Excel. Despite being an in-memory format instead of a file format, Arrow’s open specification makes it accessible to different consumers even without a file extension.\nThis has two significant benefits: it allows for easy sharing of data between programs, and it enables fast and memory-efficient data sharing by multiple programs accessing the same memory instead of creating separate copies.\nSpeed All of this means that the new columnar format should show large improvements when it comes to manipulation of the data. Below is a table showing the speedups that were tested on this new pandas version, using both NumPy and PyArrow.\nSpeedup Demonstration So how can you start using this in your own code? First of all you will need to update to the most recent version of pandas:\npip install \"pandas\u003e=2.0.0\" # You might also need to download this pip install pyarrow After you have the most recent version of pandas you can run some quick examples to see how much this new change can influence your daily workflow. The following example is from reading a database with 500,000 rows, 41 columns with numerical and categorical data.\nThen, all you need to do is read data with the pyarrow engine, like the following:\ndf = pd.read_csv(fname) df_pyarrow = pd.read_csv(fname, engine='pyarrow', dtype_backend='pyarrow') After experimenting some common manipulations of data, specially with strings, the following table was created:\nThese results clearly show a huge improvement when it comes to string manipulation, but also when reading from large files. Panda’s 2.0.0 will be a great addition to your everyday workflow!\n","wordCount":"779","inLanguage":"en","image":"https://tomascostak.github.io/blogs/pyarrow/covers/pandas.png","datePublished":"2024-07-15T11:30:00Z","dateModified":"2024-07-15T11:30:00Z","author":{"@type":"Person","name":"TomasCostaK"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tomascostak.github.io/blogs/pyarrow/"},"publisher":{"@type":"Organization","name":"TomasCostaK","logo":{"@type":"ImageObject","url":"https://tomascostak.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomascostak.github.io/ accesskey=h title="TomasCostaK (Alt + H)">TomasCostaK</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tomascostak.github.io/blogs/ title=Blog><span>Blog</span></a></li><li><a href=https://tomascostak.github.io/projects/ title=Projects><span>Projects</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Pandas 2.0 - How to make your DataFrame manipulations super fast!</h1><div class=post-description>How Panda's new update will boost your Data transformations as a Data Practitioner</div><div class=post-meta><span title='2024-07-15 11:30:00 +0000 UTC'>July 15, 2024</span>&nbsp;·&nbsp;TomasCostaK</div></header><figure class=entry-cover><img loading=eager src=https://tomascostak.github.io/covers/pandas.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#pandas-200 aria-label="Pandas 2.0.0">Pandas 2.0.0</a></li><li><a href=#what-is-apachearrow aria-label="What is Apache Arrow?">What is Apache Arrow?</a></li><li><a href=#why-is-this-important aria-label="Why is this important?">Why is this important?</a><ul><li><a href=#missing-values aria-label="Missing values">Missing values</a></li><li><a href=#interoperability aria-label=Interoperability>Interoperability</a></li><li><a href=#speed aria-label=Speed>Speed</a></li></ul></li><li><a href=#speedup-demonstration aria-label="Speedup Demonstration">Speedup Demonstration</a></li></ul></div></details></div><div class=post-content><p>Panda&rsquo;s new update just dropped and with this new update, many new improvements were introduced.</p><p>JetBrain&rsquo;s Developer Survey shows that 55% of Python users, use Panda&rsquo;s library. Therefore, we know that this massive library adoption comes with a potential to give a lot of performance boost to everyone using it. This is exactly the main point of this new 2.0.0 update.</p><h2 id=pandas-200>Pandas 2.0.0<a hidden class=anchor aria-hidden=true href=#pandas-200>#</a></h2><p>The main change to Panda&rsquo;s 2.0.0 that we will be covered in this article is the new backend support for Apache Arrow.</p><p>For many years, the main extension to represent arrays and perform operations on them in a fast way has been NumPy. And this is what pandas was initially built on.</p><p>And although NumPy has been instrumental in making pandas the widely-used library it is today, it wasn&rsquo;t designed to be a backend for dataframe libraries, and it has several notable shortcomings. For instance, it provides limited support for strings and doesn&rsquo;t include a native mechanism for handling missing values.</p><p>Dealing with missing (null) values in pandas has been challenging, partially since it doesn&rsquo;t allow null values for certain data types, such as integer dtypes. Consequently, introducing a null value in an integer column caused the entire column to be converted to a float dtype. This sudden conversion from integer to float was far from ideal. This is just one of the points that Arrow solves.</p><h2 id=what-is-apachearrow>What is Apache Arrow?<a hidden class=anchor aria-hidden=true href=#what-is-apachearrow>#</a></h2><p>According to Apache Arrow&rsquo;s <a href=https://arrow.apache.org/>website</a>:</p><blockquote><p>&ldquo;Apache Arrow defines a language-independent columnar memory format for flat and hierarchical data, organized for efficient analytic operations on modern hardware like CPUs and GPUs. The Arrow memory format also supports zero-copy reads for lightning-fast data access without serialization overhead.&rdquo;</p></blockquote><p>This means that the format is language-independent and there is no need to make copy and conversion operations between different data types. This makes it a great format to perform in-memory analytics, something that most Data Science practitioners perform daily.</p><p><img loading=lazy src=../images/pandas_img1.png alt="Image displaying Arrow&amp;rsquo;s Memory conversion between data types vs. traditional" title="Arrow Memory conversion between data types vs. traditional (from Apache Arrow Website)"></p><p>Columnar data stores are designed to store data in a way that groups related columns together in memory. This results in faster data operations such as calculating the average value of a column. Additionally, Arrow data types also include helpful features such as treatment for missing values and interoperability, which will are discussed below.</p><h2 id=why-is-this-important>Why is this important?<a hidden class=anchor aria-hidden=true href=#why-is-this-important>#</a></h2><p>There&rsquo;s several important new additions with the PyArrow change, below are some of the most notable ones.</p><h3 id=missing-values>Missing values<a hidden class=anchor aria-hidden=true href=#missing-values>#</a></h3><p>As we have mentioned previously, missing values are a complex topic.</p><p>Initially, pandas handled missing values by converting numbers to floating point and using NaN. However, this approach had limitations, particularly when converting integers to floating point.</p><p>With the introduction of extension arrays, pandas added its own data types for missing values using two arrays, one for the data and another for boolean values indicating presence or absence of data.</p><p>This approach is similar to the one used by Apache Arrow&rsquo;s in-memory data representation. By using Arrow, pandas can manage missing values across data types without creating its own version for each type.</p><h3 id=interoperability>Interoperability<a hidden class=anchor aria-hidden=true href=#interoperability>#</a></h3><p>Like a CSV file, Arrow is a universal data format that is compatible with various programs such as pandas, R, and Excel. Despite being an in-memory format instead of a file format, Arrow&rsquo;s open specification makes it accessible to different consumers even without a file extension.</p><p>This has two significant benefits: it allows for easy sharing of data between programs, and it enables fast and memory-efficient data sharing by multiple programs accessing the same memory instead of creating separate copies.</p><h3 id=speed>Speed<a hidden class=anchor aria-hidden=true href=#speed>#</a></h3><p>All of this means that the new columnar format should show large improvements when it comes to manipulation of the data. Below is a table showing the speedups that were tested on this new pandas version, using both NumPy and PyArrow.</p><h2 id=speedup-demonstration>Speedup Demonstration<a hidden class=anchor aria-hidden=true href=#speedup-demonstration>#</a></h2><p>So how can you start using this in your own code? First of all you will need to update to the most recent version of pandas:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install <span style=color:#e6db74>&#34;pandas&gt;=2.0.0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># You might also need to download this</span>
</span></span><span style=display:flex><span>pip install pyarrow
</span></span></code></pre></div><p>After you have the most recent version of pandas you can run some quick examples to see how much this new change can influence your daily workflow. The following example is from reading a database with 500,000 rows, 41 columns with numerical and categorical data.</p><p>Then, all you need to do is read data with the pyarrow engine, like the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(fname)
</span></span><span style=display:flex><span>df_pyarrow <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(fname, engine<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;pyarrow&#39;</span>, dtype_backend<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;pyarrow&#39;</span>)
</span></span></code></pre></div><p>After experimenting some common manipulations of data, specially with strings, the following table was created:</p><p><img loading=lazy src=../images/pandas_img2.png alt="Table comparison of speedup times" title="Timing of common operations using %%timeit"></p><p>These results clearly show a huge improvement when it comes to string manipulation, but also when reading from large files. Panda&rsquo;s 2.0.0 will be a great addition to your everyday workflow!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://tomascostak.github.io/tags/ml/>ML</a></li><li><a href=https://tomascostak.github.io/tags/data-science/>Data Science</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://tomascostak.github.io/>TomasCostaK</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>